SAMO API: Получение полной информации о туре
Формирование запроса поиска тура (SearchTour)
Для получения списка туров с полной информацией необходимо использовать метод поиска туров SAMO API – например, вызов SearchTour. Запрос к API должен включать обязательные параметры аутентификации и формат ответа. В частности, требуется указать:

samo_action=api – фиксированный параметр для вызова API (Anex Tour Partner Api's | Get Started | Postman API Network).

oauth_token – ваш токен авторизации (получается у SAMO/Anex Tour, передается обычно в заголовке Authorization или как параметр запроса) (Anex Tour Partner Api's | Get Started | Postman API Network).

type – формат ответа (json или xml) (Anex Tour Partner Api's | Get Started | Postman API Network).

action=SearchTour – название выполняемого действия (поиск тура) (Anex Tour Partner Api's | Get Started | Postman API Network).

Помимо этих обязательных параметров, нужно задать критерии поиска тура: город вылета, направление (страна/курорт), даты и продолжительность, состав туристов и т.д. Например, в запросе используются параметры:

TOWNFROMINC – город вылета (ID города отправления) (Price Search | Anex Tour Partner Api's | Postman API Network).

STATEINC – страна назначения (ID страны; может также поддерживать указание курорта) (Price Search | Anex Tour Partner Api's | Postman API Network).

CHECKIN_BEG и CHECKIN_END – диапазон дат вылета/заезда (начальная и конечная даты в формате ГГГГММДД) (Price Search | Anex Tour Partner Api's | Postman API Network).

NIGHTS_FROM и NIGHTS_TILL – диапазон количества ночей в туре (Price Search | Anex Tour Partner Api's | Postman API Network).

ADULT и при необходимости CHILD – количество взрослых и детей (Price Search | Anex Tour Partner Api's | Postman API Network).

CURRENCY – код валюты для цен (необязательный параметр).

FILTER – флаг применения фильтра (например, 1 чтобы отфильтровать только доступные варианты) (Price Search | Anex Tour Partner Api's | Postman API Network).

Запрос можно вызывать методом GET по соответствующему endpoint. Например, формат URL может быть:



.../samo/SearchTour/PRICES?TOWNFROMINC=<город>&STATEINC=<страна>&CHECKIN_BEG=<дата1>&CHECKIN_END=<дата2>&NIGHTS_FROM=<min ночей>&NIGHTS_TILL=<max ночей>&ADULT=<число>&FILTER=1...
В примере из документации вызов Price Search обращается к ресурсу /samo/SearchTour/PRICES с перечисленными выше параметрами фильтрации (Price Search | Anex Tour Partner Api's | Postman API Network) (Price Search | Anex Tour Partner Api's | Postman API Network). Токен при этом передаётся через Bearer Authorization (OAuth) (Price Search | Anex Tour Partner Api's | Postman API Network). Важно убедиться, что все необходимые параметры указаны, иначе результаты могут быть неполными или запрос не выполнится.

Поля, возвращаемые в SearchTour (раздел TOURS)
Результат выполнения поиска тура возвращается в структуре, содержащей список туров. В ответе (JSON или XML) обычно присутствует массив объектов под ключом TOURS – каждый объект представляет один найденный тур (предложение). Для каждого тура предоставляются следующие основные поля:

Город/курорт – название города или курорта назначения, куда прибывает тур. Обычно это пункт назначения (например, курорт или отельный регион). Если запрос охватывал несколько стран/городов, у каждого тура будет указано конкретное направление.

Отель – название отеля, включённого в тур. Это поле идентифицирует объект размещения в туре. Также могут возвращаться сопутствующие данные отеля, например категория.

Питание – тип питания в отеле (например, BB – завтрак, HB – полупансион, AI – всё включено и т.д.).

Категория отеля (рейтинг) – звездность отеля (число звёзд). Поле может обозначаться числовым рейтингом или количеством звёзд (например, 5 для 5★).

Цена тура – стоимость тура (обычно общая цена за заданное количество человек и выбранное количество ночей). Как правило, цена возвращается в указанной валюте поиска (или валюте по умолчанию) (Price Search | Anex Tour Partner Api's | Postman API Network).

Транспорт – информация о транспорте, включённом в тур. В случае пакетного тура обычно указывается тип перелёта (например, регулярный рейс или чартер) либо код транспорта. Это может быть поле, указывающее вид перевозки (авиа, ж/д, автобус) и возможно детали рейса (например, “авиа (charter)”).

Размещение (комнаты) – описание размещения в номере, включая тип номера и состав размещаемых. Например, может быть указан тип комнаты (DBL – двухместный номер) и состав гостей (2 ADL – 2 взрослых). Если в запросе запрошено несколько номеров, структура может содержать информацию по каждому номеру.

Услуги – дополнительные услуги, включённые в тур. Обычно это индикаторы включения трансфера, страховки, визовой поддержки и т.п. Например, поле может показывать, входит ли трансфер до отеля, экскурсионное обслуживание, и прочие опции, которые идут в комплекте. Формат представления может быть булевыми флагами либо перечислением услуг.

Ссылка – URL-ссылка на описание или бронирование тура. Многие агрегаторы предоставляют прямую ссылку, по которой можно перейти для просмотра детали тура в веб-интерфейсе или совершения бронирования. В ответе SAMO API поле ссылки может содержать URL на веб-страницу данного предложения либо уникальный идентификатор, по которому можно сформировать ссылку.

Помимо перечисленных, возвращаются и служебные поля: например, ID тура (уникальный идентификатор предложения) и данные, необходимые для последующего бронирования (например, код отеля, код перевозки и т.д.). Все эти поля находятся внутри структуры TOURS в ответе на запрос SearchTour. Таким образом, единичный элемент в массиве TOURS содержит город вылета/прибытия, название и параметры отеля, питание, длительность, цену и прочие характеристики конкретного тура.

Дополнительные вызовы для деталей тура по ID
Результат метода SearchTour дает основную информацию, достаточную для предварительного ознакомления и выбора тура. Однако, для получения полных деталей тура (например, точное описание всех услуг, маршрута перелёта с временем, подробного описания отеля, программы тура и т.д.) может потребоваться дополнительный запрос по идентификатору тура.

Документация SAMO API указывает на возможность выполнить отдельный метод для расчёта и получения детальной информации по выбранному туру. После того, как из поиска вы получаете TourID (или аналогичный идентификатор предложения), вы можете вызвать специальный метод – например, CalcFull – с передачей этого ID тура. Этот дополнительный вызов произведёт полный перерасчёт стоимости с учётом актуальных данных и вернёт расширенную информацию о туре. В ответе такого метода обычно содержится развернутая структура: отдельные компоненты тура (перелёт туда и обратно с кодами рейсов и временем, трансферы, проживание в отеле с указанием типа номера, питание, страховка и т.д.) и итоговая цена с разбивкой по услугам. Такой подход позволяет удостовериться, что цена актуальна на момент бронирования и получить всё необходимое для оформления тура.

Также в SAMO API имеются методы для получения конкретных частей информации: например, метод GetServices может вернуть список дополнительных услуг, доступных для данного тура (если они не были перечислены напрямую) (Price Search | Anex Tour Partner Api's | Postman API Network), а HotelData – получить описание отеля и список изображений отдельно (Price Search | Anex Tour Partner Api's | Postman API Network). В контексте полного процесса бронирования сначала выполняется поиск (SearchTour), затем по выбранному туру выполняется запрос деталей (по ID тура), после чего можно последовательно задавать дополнительные параметры (туристы, доп. услуги) и сохранять заявку. Если же цель – просто получить все детали для отображения пользователю, достаточно использования SearchTour (для основных полей) и при необходимости одного дополнительного запроса на детали тура.

Интерпретация структуры ответа
Ответ API на запрос SearchTour приходит в структурированном виде (JSON либо XML). Разработчику необходимо правильно интерпретировать вложенные разделы:

В корне ответа присутствует раздел, содержащий результаты поиска туров. В JSON это может быть объект с ключами, в XML – соответствующий элемент. Главный интерес представляет массив TOURS, в котором перечислены найденные туры.

Каждый элемент внутри TOURS содержит поля (как перечислено выше) с информацией о конкретном турпредложении. Следует использовать названия полей из документации при парсинге JSON. Например, можно ожидать поля вроде HotelName, ResortName/CityName, Meal, Stars, Price и т.п. (точные названия полей соответствуют документированным в SAMO API).

Некоторые ответы могут также включать сопутствующие разделы. Например, может присутствовать раздел PRICES – в некоторых режимах поиск возвращает подробный список цен по датам или вариантам. Однако при запросе полного списка туров обычно основная информация находится именно в TOURS. Если API возвращает TOURS и PRICES одновременно, нужно понимать, что TOURS – это обобщенная информация по каждому туру, а PRICES может детализировать цены/варианты внутри тура. Документация SAMO уточняет структуру – при необходимости можно вызвать либо конкретно SearchTour/TOURS, либо SearchTour/PRICES в запросе. В контексте получения полной информации о туре достаточно использовать данные из TOURS, так как в каждом туре уже есть поле с ценой и другими параметрами.

Поле Link (ссылка) из каждого тура может использоваться для формирования перехода на страницу тура. Если API сразу предоставляет готовый URL, его можно использовать напрямую. Если же дается, например, ID предложения, то ссылку формирует интегратор по шаблону (указанному в документации или предоставленному отдельно).

После получения идентификатора тура (например, поля ID), при необходимости выполняется второй запрос (как описано выше) – его ответ может иметь другую структуру (например, разбиение по сервисам: перелет, отель, трансфер и т.д.). Этот ответ нужно интерпретировать согласно документации: обычно он содержит подробный перечень услуг тура. Каждая услуга может быть в своем списке (например, блок Transportation, Accommodation, Transfer, Insurance и пр.). Разработчику следует собрать эти данные для отображения полной комплектации тура пользователю.

Таким образом, оптимальный подход – сначала выполнить поиск туров через метод SearchTour с нужными параметрами (город вылета, направление, даты, длительность, состав туристов и пр.), получив список туров с ключевой информацией (город, отель, питание, рейтинг, цена, транспорт, размещение, услуги, ссылка и т.д.). Далее, если необходимо узнать детали, можно воспользоваться дополнительным вызовом API по ID тура, чтобы получить всю структуру тура вплоть до конкретных услуг. Интерпретация ответа сводится к разбору JSON/XML по документированной структуре: ключевые поля из раздела TOURS для общего списка и детализация по отдельному запросу для полного описания выбранного тура. При соблюдении документации SAMO API и использовании корректных параметров запроса вы получите полную информацию о туре и сможете отобразить ее пользователю.

Источник: Официальная документация SAMO API (раздел Online Search Tours) (Anex Tour Partner Api's | Get Started | Postman API Network) (Price Search | Anex Tour Partner Api's | Postman API Network), примеры параметров поиска туров (Price Search | Anex Tour Partner Api's | Postman API Network) (Price Search | Anex Tour Partner Api's | Postman API Network).


Изменить
•
Добавить ссылку как вложение
•
Удалить

Maxat Bekes 6 мар. 2025 г., 13:27

Departure towns
curl 'https://booking.crystalbay.com/export/default.php?samo_action=api&oauth_token=27bd59a7ac67422189789f0188167379&type=json&action=SearchTour_TOWNFROMS'

Available tours from Almaty to Tashkent (confirmed)
curl 'https://booking.crystalbay.com/export/default.php?samo_action=api&oauth_token=27bd59a7ac67422189789f0188167379&type=json&action=SearchTour_TOURS&townfrom=1344&townto=1853&checkin=2025-04-01&checkout=2025-04-10&nights_min=3&nights_max=7&adults=2'

Destination towns (Uzbekistan from Almaty, XML POST)
curl --location --request POST 'https://booking.crystalbay.com/export/default.php?samo_action=api&oauth_token=27bd59a7ac67422189789f0188167379&type=json&action=SearchTour_TOWNS' 
--header 'Content-Type: application/xml' 
--data '<?xml version="1.0" encoding="utf-8"?><data><STATEINC>35</STATEINC><TOWNFROMINC>1344</TOWNFROMINC></data>'

All Available Data (Uzbekistan from Almaty, XML POST)
curl --location --request POST 'https://booking.crystalbay.com/export/default.php?samo_action=api&oauth_token=27bd59a7ac67422189789f0188167379&type=json&action=SearchTour_ALL' 
--header 'Content-Type: application/xml' 
--data '<?xml version="1.0" encoding="utf-8"?><data><STATEINC>35</STATEINC><TOWNFROMINC>1344</TOWNFROMINC><PRODUCTTYPE>1</PRODUCTTYPE></data>'

Tours using XML POST (alternative)
curl --location --request POST 'https://booking.crystalbay.com/export/default.php?samo_action=api&oauth_token=27bd59a7ac67422189789f0188167379&type=json&action=SearchTour_TOURS' 
--header 'Content-Type: application/xml' 
--data '<?xml version="1.0" encoding="utf-8"?><data><STATEINC>35</STATEINC><TOWNFROMINC>1344</TOWNFROMINC><PRODUCTTYPE>1</PRODUCTTYPE></data>'