{% extends "layout.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-server me-2"></i>Статус Production</h2>
                <button class="btn btn-outline-primary" onclick="checkAPIStatus()">
                    <i class="bi bi-arrow-clockwise me-1"></i>Обновить статус
                </button>
            </div>
            
            <!-- API Status Card -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-cloud-arrow-up me-2"></i>SAMO API Статус</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <strong>Development Environment</strong><br>
                                IP: 34.139.221.108 - Заблокирован SAMO API (ожидаемо)
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-success">
                                <i class="bi bi-check-circle me-2"></i>
                                <strong>Production Environment</strong><br>
                                IP: 46.250.234.89 - Работает с реальными данными SAMO
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>SAMO API Endpoints:</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Endpoint</th>
                                            <th>Development</th>
                                            <th>Production</th>
                                            <th>Описание</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>SearchTour_CURRENCIES</td>
                                            <td><span class="badge bg-danger">403</span></td>
                                            <td><span class="badge bg-success">200</span></td>
                                            <td>Валюты для поиска</td>
                                        </tr>
                                        <tr>
                                            <td>SearchTour_STATES</td>
                                            <td><span class="badge bg-danger">403</span></td>
                                            <td><span class="badge bg-success">200</span></td>
                                            <td>Направления (Вьетнам)</td>
                                        </tr>
                                        <tr>
                                            <td>SearchTour_TOWNFROMS</td>
                                            <td><span class="badge bg-danger">403</span></td>
                                            <td><span class="badge bg-success">200</span></td>
                                            <td>Города отправления</td>
                                        </tr>
                                        <tr>
                                            <td>SearchTour_HOTELS</td>
                                            <td><span class="badge bg-danger">403</span></td>
                                            <td><span class="badge bg-success">200</span></td>
                                            <td>Отели Вьетнама</td>
                                        </tr>
                                        <tr>
                                            <td>SearchTour_ALL</td>
                                            <td><span class="badge bg-danger">403</span></td>
                                            <td><span class="badge bg-success">200</span></td>
                                            <td>Поиск туров</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Configuration -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Конфигурация системы</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Рынок и направления:</h6>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-arrow-right text-primary me-2"></i>Казахстан → Вьетнам</li>
                                <li><i class="bi bi-geo-alt text-primary me-2"></i>Алматы (ALA), Астана (NQZ)</li>
                                <li><i class="bi bi-currency-exchange text-primary me-2"></i>KZT приоритетная валюта</li>
                                <li><i class="bi bi-translate text-primary me-2"></i>Русский язык интерфейса</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Интеграции:</h6>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-check-circle text-success me-2"></i>SAMO API OAuth токен</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Без демо данных</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Production-ready код</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Обработка ошибок API</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Deployment Status -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-rocket me-2"></i>Готовность к Production</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>Система готова к deployment:</strong><br>
                                Все демо данные удалены, API интеграция настроена, система показывает корректные ошибки при недоступности SAMO API.
                                При развертывании на production сервере (46.250.234.89) система автоматически начнет работать с реальными данными.
                            </div>
                            
                            <h6>Проверочный список:</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Удалены mock данные
                                            <span class="badge bg-success rounded-pill">✓</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            SAMO API интеграция
                                            <span class="badge bg-success rounded-pill">✓</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Обработка ошибок
                                            <span class="badge bg-success rounded-pill">✓</span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Казахстанский рынок
                                            <span class="badge bg-success rounded-pill">✓</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Русский интерфейс
                                            <span class="badge bg-success rounded-pill">✓</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Production токен
                                            <span class="badge bg-success rounded-pill">✓</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function checkAPIStatus() {
    // Проверяем статус API
    fetch('/api/tours/filters')
        .then(response => response.json())
        .then(data => {
            if (data.requires_production) {
                showAlert('warning', 'SAMO API требует production сервер (IP: 46.250.234.89)');
            } else if (data.success) {
                showAlert('success', 'SAMO API доступен и работает корректно');
            } else {
                showAlert('danger', 'Ошибка подключения к SAMO API: ' + data.error);
            }
        })
        .catch(error => {
            showAlert('danger', 'Ошибка проверки статуса: ' + error.message);
        });
}

function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show mt-3`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.querySelector('.container-fluid').insertBefore(alertDiv, document.querySelector('.row'));
    
    setTimeout(() => {
        alertDiv.remove();
    }, 5000);
}
</script>
{% endblock %}