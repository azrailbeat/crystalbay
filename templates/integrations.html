{% extends "layout.html" %}

{% block title %}Crystal Bay Travel - Интеграции{% endblock %}

{% block page_title %}Интеграции{% endblock %}

{% block head %}
<style>
    .integrations-header {
        margin-bottom: 1.5rem;
    }
    
    .integration-card {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        margin-bottom: 1.5rem;
        overflow: hidden;
    }
    
    .integration-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--light-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .integration-title {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .integration-logo {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    
    .integration-logo.telegram {
        background-color: #0088cc;
        color: white;
    }
    
    .integration-logo.samo {
        background-color: #FF5E55;
        color: white;
    }
    
    .integration-logo.supabase {
        background-color: #3FCF8E;
        color: white;
    }
    
    .integration-logo.openai {
        background-color: #10A37F;
        color: white;
    }
    
    .integration-logo.sendgrid {
        background-color: #1A82E2;
        color: white;
    }
    
    .integration-name {
        font-weight: 600;
        font-size: 1.2rem;
        margin: 0;
    }
    
    .integration-status {
        font-size: 0.85rem;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-weight: 500;
    }
    
    .integration-status.connected {
        background-color: rgba(52, 199, 89, 0.1);
        color: var(--success-color);
    }
    
    .integration-status.disconnected {
        background-color: rgba(142, 142, 147, 0.1);
        color: var(--secondary-color);
    }
    
    .integration-status.error {
        background-color: rgba(255, 59, 48, 0.1);
        color: var(--danger-color);
    }
    
    .integration-body {
        padding: 1.5rem;
    }
    
    .integration-description {
        color: var(--secondary-color);
        margin-bottom: 1.5rem;
    }
    
    .integration-settings {
        margin-bottom: 1.5rem;
    }
    
    .settings-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--light-border);
    }
    
    .settings-row:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }
    
    .settings-label {
        font-weight: 500;
    }
    
    .settings-value {
        color: var(--secondary-color);
    }
    
    .api-key-field {
        position: relative;
    }
    
    .api-key-input {
        padding-right: 40px;
    }
    
    .api-key-action {
        position: absolute;
        right: 0;
        top: 0;
        height: 100%;
        width: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        color: var(--secondary-color);
        cursor: pointer;
    }
    
    .api-key-action:hover {
        color: var(--primary-color);
    }
    
    .webhook-url {
        display: flex;
        align-items: center;
    }
    
    .webhook-url .form-control {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }
    
    .webhook-url .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Integrations Header -->
    <div class="integrations-header">
        <p class="text-secondary">Управляйте интеграциями с внешними сервисами и API для расширения функциональности Crystal Bay Travel.</p>
    </div>
    
    <!-- Telegram Integration -->
    <div class="integration-card">
        <div class="integration-header">
            <div class="integration-title">
                <div class="integration-logo telegram">
                    <i class="bi bi-telegram"></i>
                </div>
                <h2 class="integration-name">Telegram</h2>
            </div>
            <span class="integration-status connected">Подключено</span>
        </div>
        <div class="integration-body">
            <div class="integration-description">
                Telegram Bot API позволяет вашим клиентам искать и бронировать туры через мессенджер Telegram.
            </div>
            
            <div class="integration-settings">
                <div class="settings-row">
                    <div class="settings-label">Статус бота</div>
                    <div class="settings-value text-success">Активен</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">API Token</div>
                    <div class="api-key-field">
                        <input type="password" class="form-control api-key-input" value="********************************" readonly>
                        <button class="api-key-action" title="Показать/скрыть">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Название бота</div>
                    <div class="settings-value">@CrystalBayTravel_Bot</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Обработано сообщений</div>
                    <div class="settings-value">854</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Активных пользователей</div>
                    <div class="settings-value">124</div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between">
                <button class="btn btn-outline-secondary"><i class="bi bi-arrow-repeat me-2"></i> Перезапустить бота</button>
                <div>
                    <button class="btn btn-outline-secondary me-2"><i class="bi bi-sliders me-2"></i> Настройки</button>
                    <button class="btn btn-outline-danger"><i class="bi bi-trash me-2"></i> Отключить</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SAMO API Integration -->
    <div class="integration-card">
        <div class="integration-header">
            <div class="integration-title">
                <div class="integration-logo samo">
                    <i class="bi bi-database"></i>
                </div>
                <h2 class="integration-name">SAMO Туристический офис</h2>
            </div>
            <span class="integration-status connected">Подключено</span>
        </div>
        <div class="integration-body">
            <div class="integration-description">
                SAMO API позволяет получать данные о турах, доступных для бронирования, и управлять бронированиями в системе SAMO Туристический офис.
            </div>
            
            <div class="integration-settings">
                <div class="settings-row">
                    <div class="settings-label">OAuth Token</div>
                    <div class="api-key-field">
                        <input type="password" class="form-control api-key-input" value="********************************" readonly>
                        <button class="api-key-action" title="Показать/скрыть">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">API URL</div>
                    <div class="settings-value">https://api.samo.travel/v1</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Статус сервиса</div>
                    <div class="settings-value text-success">Доступен</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Последнее обновление данных</div>
                    <div class="settings-value">4 мая 2025, 15:30</div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between">
                <button class="btn btn-outline-secondary"><i class="bi bi-arrow-repeat me-2"></i> Обновить данные</button>
                <div>
                    <button class="btn btn-outline-secondary me-2"><i class="bi bi-sliders me-2"></i> Настройки</button>
                    <button class="btn btn-outline-danger"><i class="bi bi-trash me-2"></i> Отключить</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Supabase Integration -->
    <div class="integration-card">
        <div class="integration-header">
            <div class="integration-title">
                <div class="integration-logo supabase">
                    <i class="bi bi-database"></i>
                </div>
                <h2 class="integration-name">Supabase</h2>
            </div>
            <span class="integration-status connected">Подключено</span>
        </div>
        <div class="integration-body">
            <div class="integration-description">
                Supabase предоставляет базу данных для хранения информации о клиентах, бронированиях и обращениях.
            </div>
            
            <div class="integration-settings">
                <div class="settings-row">
                    <div class="settings-label">URL</div>
                    <div class="settings-value">https://xxxxxxxxxxx.supabase.co</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">API Key</div>
                    <div class="api-key-field">
                        <input type="password" class="form-control api-key-input" value="********************************" readonly>
                        <button class="api-key-action" title="Показать/скрыть">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Статус соединения</div>
                    <div class="settings-value text-success">Подключено</div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between">
                <button class="btn btn-outline-secondary"><i class="bi bi-arrow-repeat me-2"></i> Проверить соединение</button>
                <div>
                    <button class="btn btn-outline-secondary me-2"><i class="bi bi-sliders me-2"></i> Настройки</button>
                    <button class="btn btn-outline-danger"><i class="bi bi-trash me-2"></i> Отключить</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- OpenAI Integration -->
    <div class="integration-card">
        <div class="integration-header">
            <div class="integration-title">
                <div class="integration-logo openai">
                    <i class="bi bi-cpu"></i>
                </div>
                <h2 class="integration-name">OpenAI</h2>
            </div>
            <span class="integration-status connected">Подключено</span>
        </div>
        <div class="integration-body">
            <div class="integration-description">
                OpenAI API используется для обработки запросов клиентов на естественном языке и предоставления рекомендаций по турам.
            </div>
            
            <div class="integration-settings">
                <div class="settings-row">
                    <div class="settings-label">API Key</div>
                    <div class="api-key-field">
                        <input type="password" class="form-control api-key-input" value="********************************" readonly>
                        <button class="api-key-action" title="Показать/скрыть">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Используемая модель</div>
                    <div class="settings-value">gpt-4o</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Цена за 1000 токенов</div>
                    <div class="settings-value">$0.03 / $0.06 (input/output)</div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Использовано токенов в этом месяце</div>
                    <div class="settings-value">125,487</div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between">
                <button class="btn btn-outline-secondary"><i class="bi bi-arrow-repeat me-2"></i> Проверить API</button>
                <div>
                    <button class="btn btn-outline-secondary me-2"><i class="bi bi-sliders me-2"></i> Настройки</button>
                    <button class="btn btn-outline-danger"><i class="bi bi-trash me-2"></i> Отключить</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SendGrid Integration (Disconnected) -->
    <div class="integration-card">
        <div class="integration-header">
            <div class="integration-title">
                <div class="integration-logo sendgrid">
                    <i class="bi bi-envelope"></i>
                </div>
                <h2 class="integration-name">SendGrid</h2>
            </div>
            <span class="integration-status disconnected">Не подключено</span>
        </div>
        <div class="integration-body">
            <div class="integration-description">
                SendGrid API позволяет отправлять электронные письма клиентам и управлять рассылками.
            </div>
            
            <div class="integration-settings">
                <div class="settings-row">
                    <div class="settings-label">API Key</div>
                    <div class="api-key-field">
                        <input type="text" class="form-control" placeholder="Введите API ключ SendGrid">
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Адрес отправителя</div>
                    <div class="api-key-field">
                        <input type="email" class="form-control" placeholder="Введите email адрес отправителя">
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">Название отправителя</div>
                    <div class="api-key-field">
                        <input type="text" class="form-control" placeholder="Crystal Bay Travel" value="Crystal Bay Travel">
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-end">
                <button class="btn btn-primary"><i class="bi bi-plus-circle me-2"></i> Подключить</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle API key visibility
        const toggleButtons = document.querySelectorAll('.api-key-action');
        toggleButtons.forEach(button => {
            button.addEventListener('click', function() {
                const input = this.previousElementSibling;
                const icon = this.querySelector('i');
                
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('bi-eye');
                    icon.classList.add('bi-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('bi-eye-slash');
                    icon.classList.add('bi-eye');
                }
            });
        });
    });
</script>
{% endblock %}