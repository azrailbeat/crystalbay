{% extends "layout.html" %}

{% block title %}Crystal Bay Travel - Сообщения{% endblock %}

{% block page_title %}Сообщения{% endblock %}

{% block head %}
<style>
    .messages-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .messages-filters {
        display: flex;
        gap: 0.75rem;
    }
    
    .message-list {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        overflow: hidden;
    }
    
    .message-item {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--light-border);
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    
    .message-item:hover {
        background-color: var(--light-accent);
    }
    
    .message-item.unread {
        background-color: rgba(0, 113, 227, 0.05);
    }
    
    .message-item.unread:hover {
        background-color: rgba(0, 113, 227, 0.1);
    }
    
    .message-item.selected {
        background-color: rgba(0, 113, 227, 0.1);
    }
    
    .message-sender {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }
    
    .message-sender-name {
        font-weight: 600;
        color: var(--text-color);
    }
    
    .message-time {
        color: var(--secondary-color);
        font-size: 0.85rem;
    }
    
    .message-subject {
        font-weight: 500;
        margin-bottom: 0.3rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .message-preview {
        color: var(--secondary-color);
        font-size: 0.9rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .message-item.unread .message-sender-name,
    .message-item.unread .message-subject {
        font-weight: 700;
    }
    
    .message-detail {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
    }
    
    .message-detail-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--light-border);
    }
    
    .message-detail-subject {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-color);
    }
    
    .message-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--secondary-color);
        font-size: 0.9rem;
    }
    
    .message-from {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background-color: var(--light-accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        font-weight: 500;
        color: var(--primary-color);
    }
    
    .message-sender-info .message-sender-name {
        margin-bottom: 0.1rem;
    }
    
    .message-sender-info .message-sender-email {
        font-size: 0.8rem;
    }
    
    .message-date {
        color: var(--secondary-color);
    }
    
    .message-detail-content {
        padding: 1.5rem;
    }
    
    .message-body {
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }
    
    .message-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .message-reply {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        margin-top: 1rem;
        padding: 1.5rem;
    }
    
    .message-reply-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .message-reply-title {
        font-weight: 600;
        color: var(--text-color);
    }
    
    .lead-tag {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 500;
        margin-right: 0.5rem;
    }
    
    .lead-tag.new {
        background-color: rgba(0, 113, 227, 0.1);
        color: var(--primary-color);
    }
    
    .lead-tag.contacted {
        background-color: rgba(52, 199, 89, 0.1);
        color: var(--success-color);
    }
    
    .lead-tag.qualified {
        background-color: rgba(255, 149, 0, 0.1);
        color: var(--warning-color);
    }
    
    .lead-tag.converted {
        background-color: rgba(175, 82, 222, 0.1);
        color: var(--purple-color);
    }
    
    .message-folder {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        margin-bottom: 1rem;
    }
    
    .folder-item {
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: var(--text-color);
        cursor: pointer;
        border-bottom: 1px solid var(--light-border);
    }
    
    .folder-item:last-child {
        border-bottom: none;
    }
    
    .folder-item:hover {
        background-color: var(--light-accent);
    }
    
    .folder-item.active {
        background-color: rgba(0, 113, 227, 0.1);
        font-weight: 500;
        color: var(--primary-color);
    }
    
    .folder-icon {
        color: var(--secondary-color);
        width: 20px;
        text-align: center;
    }
    
    .folder-item.active .folder-icon {
        color: var(--primary-color);
    }
    
    .folder-name {
        flex-grow: 1;
    }
    
    .folder-count {
        background-color: var(--light-accent);
        border-radius: 20px;
        padding: 0.15rem 0.5rem;
        font-size: 0.75rem;
        color: var(--secondary-color);
    }
    
    .folder-item.active .folder-count {
        background-color: rgba(0, 113, 227, 0.2);
        color: var(--primary-color);
    }
    
    .no-messages {
        padding: 3rem;
        text-align: center;
        color: var(--secondary-color);
    }
    
    .no-messages-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--light-border);
    }
    
    .no-message-selected {
        padding: 3rem;
        text-align: center;
        color: var(--secondary-color);
    }
    
    .no-message-selected-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--light-border);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Messages Header -->
    <div class="messages-header">
        <div class="messages-filters">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Поиск сообщений...">
                <button class="btn btn-outline-secondary" type="button">
                    <i class="bi bi-search"></i>
                </button>
            </div>
            
            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-funnel"></i> Фильтр
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Все сообщения</a></li>
                    <li><a class="dropdown-item" href="#">Непрочитанные</a></li>
                    <li><a class="dropdown-item" href="#">Прочитанные</a></li>
                    <li><a class="dropdown-item" href="#">С вложениями</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#">Отмеченные флагом</a></li>
                </ul>
            </div>
        </div>
        
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#composeModal">
            <i class="bi bi-envelope-plus me-1"></i> Написать
        </button>
    </div>
    
    <div class="row">
        <!-- Folders Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="message-folder">
                <div class="folder-item active">
                    <div class="folder-icon"><i class="bi bi-inbox"></i></div>
                    <div class="folder-name">Входящие</div>
                    <div class="folder-count">28</div>
                </div>
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-envelope-paper"></i></div>
                    <div class="folder-name">Черновики</div>
                    <div class="folder-count">3</div>
                </div>
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-send"></i></div>
                    <div class="folder-name">Отправленные</div>
                    <div class="folder-count">15</div>
                </div>
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-flag"></i></div>
                    <div class="folder-name">Помеченные</div>
                    <div class="folder-count">5</div>
                </div>
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-archive"></i></div>
                    <div class="folder-name">Архив</div>
                    <div class="folder-count">42</div>
                </div>
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-trash"></i></div>
                    <div class="folder-name">Корзина</div>
                    <div class="folder-count">8</div>
                </div>
            </div>
            
            <div class="message-folder">
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-tag"></i></div>
                    <div class="folder-name">Запросы</div>
                    <div class="folder-count">15</div>
                </div>
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-tag"></i></div>
                    <div class="folder-name">Бронирования</div>
                    <div class="folder-count">12</div>
                </div>
                <div class="folder-item">
                    <div class="folder-icon"><i class="bi bi-tag"></i></div>
                    <div class="folder-name">Жалобы</div>
                    <div class="folder-count">1</div>
                </div>
            </div>
        </div>
        
        <!-- Message List -->
        <div class="col-md-4 col-lg-3">
            <div class="message-list">
                <div class="message-item unread" data-id="1">
                    <div class="message-sender">
                        <div class="message-sender-name">Иван Иванов</div>
                        <div class="message-time">15:42</div>
                    </div>
                    <div class="message-subject">Запрос о туре в Турцию</div>
                    <div class="message-preview">Здравствуйте! Интересуют туры в Турцию на июнь 2025 года для семьи из 2 взрослых и 1 ребенка...</div>
                </div>
                
                <div class="message-item" data-id="2">
                    <div class="message-sender">
                        <div class="message-sender-name">Елена Петрова</div>
                        <div class="message-time">Вчера</div>
                    </div>
                    <div class="message-subject">Вопрос по визе</div>
                    <div class="message-preview">Добрый день! Подскажите, пожалуйста, какие документы необходимы для получения визы в Таиланд...</div>
                </div>
                
                <div class="message-item" data-id="3">
                    <div class="message-sender">
                        <div class="message-sender-name">Александр Сидоров</div>
                        <div class="message-time">3 мая</div>
                    </div>
                    <div class="message-subject">Спасибо за отличный отдых!</div>
                    <div class="message-preview">Здравствуйте! Хочу выразить огромную благодарность за организацию нашего отдыха в Египте...</div>
                </div>
                
                <div class="message-item unread" data-id="4">
                    <div class="message-sender">
                        <div class="message-sender-name">Марина Козлова</div>
                        <div class="message-time">2 мая</div>
                    </div>
                    <div class="message-subject">Запрос о горящих турах</div>
                    <div class="message-preview">Добрый день! Интересуют горящие предложения на начало мая. Есть ли что-то интересное?...</div>
                </div>
                
                <div class="message-item" data-id="5">
                    <div class="message-sender">
                        <div class="message-sender-name">Сергей Новиков</div>
                        <div class="message-time">1 мая</div>
                    </div>
                    <div class="message-subject">Вопрос по оплате</div>
                    <div class="message-preview">Здравствуйте! Хотел бы уточнить, какие способы оплаты вы принимаете? Можно ли оплатить частями?...</div>
                </div>
            </div>
        </div>
        
        <!-- Message Detail -->
        <div class="col-md-5 col-lg-7">
            <div class="message-detail">
                <div class="message-detail-header">
                    <div class="message-detail-subject">Запрос о туре в Турцию</div>
                    <div class="message-meta">
                        <div class="message-from">
                            <div class="message-avatar">ИИ</div>
                            <div class="message-sender-info">
                                <div class="message-sender-name">Иван Иванов</div>
                                <div class="message-sender-email">ivan@example.com</div>
                            </div>
                        </div>
                        <div class="message-date">4 мая 2025, 15:42</div>
                    </div>
                </div>
                
                <div class="message-detail-content">
                    <div class="message-body">
                        <p>Здравствуйте!</p>
                        
                        <p>Интересуют туры в Турцию на июнь 2025 года для семьи из 2 взрослых и 1 ребенка.</p>
                        
                        <p>Предпочтительно отель 5* с системой "всё включено".</p>
                        
                        <p>Мой телефон для связи: +7 999 123-45-67</p>
                        
                        <p>С уважением,<br>Иван</p>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <div class="lead-details">
                            <span class="lead-tag new">Новый лид</span>
                            <span class="lead-tag">Тур в Турцию</span>
                        </div>
                        
                        <div class="message-actions">
                            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-archive"></i></button>
                            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-flag"></i></button>
                            <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                            <button class="btn btn-sm btn-primary"><i class="bi bi-reply me-1"></i> Ответить</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reply Form -->
            <div class="message-reply">
                <div class="message-reply-header">
                    <div class="message-reply-title">Ответ на сообщение</div>
                </div>
                
                <form id="replyForm">
                    <div class="mb-3">
                        <label for="replySubject" class="form-label">Тема</label>
                        <input type="text" class="form-control" id="replySubject" value="Re: Запрос о туре в Турцию">
                    </div>
                    
                    <div class="mb-3">
                        <label for="replyMessage" class="form-label">Сообщение</label>
                        <textarea class="form-control" id="replyMessage" rows="6"></textarea>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-light"><i class="bi bi-paperclip"></i> Прикрепить</button>
                        <div>
                            <button type="button" class="btn btn-light me-2"><i class="bi bi-save"></i> Сохранить черновик</button>
                            <button type="button" class="btn btn-primary"><i class="bi bi-send me-1"></i> Отправить</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Compose Modal -->
<div class="modal fade" id="composeModal" tabindex="-1" aria-labelledby="composeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="composeModalLabel">Новое сообщение</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
            </div>
            
            <div class="modal-body">
                <form id="composeForm">
                    <div class="mb-3">
                        <label for="composeTo" class="form-label">Получатель</label>
                        <input type="email" class="form-control" id="composeTo" placeholder="email@example.com">
                    </div>
                    
                    <div class="mb-3">
                        <label for="composeSubject" class="form-label">Тема</label>
                        <input type="text" class="form-control" id="composeSubject">
                    </div>
                    
                    <div class="mb-3">
                        <label for="composeMessage" class="form-label">Сообщение</label>
                        <textarea class="form-control" id="composeMessage" rows="10"></textarea>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-light"><i class="bi bi-paperclip"></i> Прикрепить</button>
                <button type="button" class="btn btn-light"><i class="bi bi-save"></i> Сохранить черновик</button>
                <button type="button" class="btn btn-primary"><i class="bi bi-send me-1"></i> Отправить</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle message list item click
        const messageItems = document.querySelectorAll('.message-item');
        
        messageItems.forEach(item => {
            item.addEventListener('click', function() {
                // Remove selected class from all items
                messageItems.forEach(i => i.classList.remove('selected'));
                
                // Add selected class to clicked item
                this.classList.add('selected');
                
                // Remove unread class (mark as read)
                this.classList.remove('unread');
                
                // In a real app, you would load the message content here
                // For demo purposes, we're just showing the static content
            });
        });
    });
</script>
{% endblock %}