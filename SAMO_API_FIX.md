# SAMO API Connection Fix - Crystal Bay Travel

## –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! ‚úÖ

–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ VPS (46.250.234.89), –Ω–æ –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π SAMO API URL.

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. URL Configuration Update
- **–°—Ç–∞—Ä—ã–π URL**: `booking-kz.crystalbay.com` (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª)
- **–ù–æ–≤—ã–π URL**: `booking.crystalbay.com` (—Ä–∞–±–æ—á–∏–π)

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `crystal_bay_samo_api.py` - –æ–±–Ω–æ–≤–ª–µ–Ω base_url –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `templates/samo_testing.html` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π URL
- `templates/unified_settings.html` - –æ–±–Ω–æ–≤–ª–µ–Ω placeholder URL

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å VPS:

–£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã SAMO API —Å —Å–µ—Ä–≤–µ—Ä–∞:
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –†–ê–ë–û–¢–ê–ï–¢
curl 'https://booking.crystalbay.com/export/default.php?samo_action=api&oauth_token=27bd59a7ac67422189789f0188167379&type=json&action=SearchTour_TOWNFROMS'

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—É—Ä–æ–≤ - –†–ê–ë–û–¢–ê–ï–¢  
curl 'https://booking.crystalbay.com/export/default.php?samo_action=api&oauth_token=27bd59a7ac67422189789f0188167379&type=json&action=SearchTour_TOURS'
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ VPS:

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd ~/crystalbay

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ —Å GitHub
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.production.yml --env-file .env up -d --build web

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl -s http://127.0.0.1:5000/health

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SAMO API —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
echo "–û—Ç–∫—Ä–æ–π—Ç–µ: http://46.250.234.89:5000/samo-testing"
```

## –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:

‚úÖ **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**: –í—Å–µ –∑–∞–ø—É—â–µ–Ω—ã –∏ –∑–¥–æ—Ä–æ–≤—ã  
‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ **Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: –î–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 5000  
‚úÖ **SAMO API**: URL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å  
‚úÖ **Health endpoint**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "healthy"  

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ)
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SAMO API** —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —Å–∏—Å—Ç–µ–º—ã

## –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ:

- **Web Dashboard**: http://46.250.234.89:5000
- **SAMO Testing**: http://46.250.234.89:5000/samo-testing  
- **Settings**: http://46.250.234.89:5000/unified-settings

## –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker logs crystalbay-web-1 -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose -f docker-compose.production.yml logs -f
```

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!** üöÄ