#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–æ–º

echo "üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –° –ü–†–û–î–ê–ö–®–ù –°–ï–†–í–ï–†–û–ú"
echo "===================================="

SERVER="46.250.234.89"
PROJECT_DIR="/home/runner/workspace"
REMOTE_DIR="~/crystalbay"

echo "üìç –°–µ—Ä–≤–µ—Ä: $SERVER"
echo "üìÅ –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞: $PROJECT_DIR"
echo "üìÅ –£–¥–∞–ª–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞: $REMOTE_DIR"

echo ""
echo "1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏..."

# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
tar -czf production_sync.tar.gz \
    templates/samo_testing.html \
    app_api.py \
    main.py \
    models.py \
    crystal_bay_samo_api.py

echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: production_sync.tar.gz"

echo ""
echo "2Ô∏è‚É£ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
echo "========================================"

cat << 'DEPLOYMENT_COMMANDS'
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ:

# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp production_sync.tar.gz root@46.250.234.89:~/

# 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@46.250.234.89

# 3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
cd ~/crystalbay
docker-compose down
tar -xzf ~/production_sync.tar.gz
docker-compose build --no-cache web
docker-compose up -d
sleep 30
curl http://127.0.0.1:5000/health

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç:
curl http://127.0.0.1:5000/api/diagnostics/samo
DEPLOYMENT_COMMANDS

echo ""
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≥–æ —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:"
echo "====================================="

echo "‚ùå –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω:"
echo "   - Unexpected token '<' –æ—à–∏–±–∫–∏"
echo "   - API endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç HTML –≤–º–µ—Å—Ç–æ JSON"
echo "   - JavaScript —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç"
echo ""
echo "‚úÖ –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:"
echo "   - –ó–µ–ª–µ–Ω—ã–π —Å—Ç–∞—Ç—É—Å 'SAMO API –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ'"
echo "   - –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ –±–µ–∑ –æ—à–∏–±–æ–∫"
echo "   - JSON –æ—Ç–≤–µ—Ç—ã –æ—Ç –≤—Å–µ—Ö API endpoints"

echo ""
echo "üìã –ì–û–¢–û–í–û –ö –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ!"
echo "–ê—Ä—Ö–∏–≤ production_sync.tar.gz —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è"